
    <div class="cart-overlay" (click)="close.emit()">
      <div class="cart-panel" (click)="$event.stopPropagation()">
        <!-- Header -->
        <div class="cart-header">
          <h2>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
            Mi Carrito
          </h2>
          <button class="close-btn" (click)="close.emit()" aria-label="Cerrar carrito">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>

        <!-- Items -->
        <div class="cart-items">
          @if (cartService.items().length === 0) {
            <div class="empty-cart">
              <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="9" cy="21" r="1"></circle>
                <circle cx="20" cy="21" r="1"></circle>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
              </svg>
              <p>Tu carrito está vacío</p>
              <button class="btn-primary" (click)="navigateToProducts()">
                Explorar Productos
              </button>
            </div>
          } @else {
            @for (item of cartService.items(); track item.reference + (item.color || '')) {
              <div class="cart-item">
                <img [src]="item.image" [alt]="item.name" class="item-image">
                <div class="item-details">
                  <h3>{{ item.name }}</h3>
                  <p class="item-ref">REF: {{ item.reference }}</p>
                  @if (item.color) {
                    <p class="item-color">Color: {{ item.color }}</p>
                  }
                  <p class="item-price">{{ item.currency }} \${{ item.price.toFixed(2) }}</p>
                </div>
                <div class="item-actions">
                  <div class="quantity-controls">
                    <button
                      (click)="decreaseQuantity(item)"
                      [disabled]="item.quantity <= 1"
                      aria-label="Disminuir cantidad">
                      −
                    </button>
                    <span>{{ item.quantity }}</span>
                    <button
                      (click)="increaseQuantity(item)"
                      aria-label="Aumentar cantidad">
                      +
                    </button>
                  </div>
                  <p class="item-subtotal">
                    \${{ (item.price * item.quantity).toFixed(2) }}
                  </p>
                  <button
                    class="remove-btn"
                    (click)="removeItem(item)"
                    aria-label="Eliminar del carrito">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                  </button>
                </div>
              </div>
            }
          }
        </div>

        <!-- Footer -->
        @if (cartService.items().length > 0) {
          <div class="cart-footer">
            <div class="cart-summary">
              <div class="summary-row">
                <span>Subtotal:</span>
                <span class="amount">\${{ cartService.subtotal().toFixed(2) }}</span>
              </div>
              <div class="summary-row">
                <span>IVA (19%):</span>
                <span class="amount">\${{ cartService.tax().toFixed(2) }}</span>
              </div>
              <div class="summary-row total">
                <span>Total:</span>
                <span class="amount">\${{ cartService.total().toFixed(2) }}</span>
              </div>
            </div>

            <div class="cart-actions">
              <button class="btn-secondary" (click)="close.emit()">
                Continuar Comprando
              </button>
              <button class="btn-primary" (click)="proceedToCheckout()">
                Proceder al Pago
              </button>
            </div>
          </div>
        }
      </div>
    </div>
  